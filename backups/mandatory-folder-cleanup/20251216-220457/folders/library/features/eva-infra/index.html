<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Enterprise-grade AI assistant platform for the Government of Canada"><meta name=author content=MarcoPolo483><link href=https://marcopolo483.github.io/eva-orchestrator/features/eva-infra/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.3"><title>EVA Infrastructure as Code (eva-infra) - EVA Suite</title><link rel=stylesheet href=../../assets/stylesheets/main.50c56a3b.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#eva-infrastructure-as-code-eva-infra class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="EVA Suite" class="md-header__button md-logo" aria-label="EVA Suite" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EVA Suite </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> EVA Infrastructure as Code (eva-infra) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/MarcoPolo483/eva-orchestrator title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> eva-orchestrator </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../eva-library/ class=md-tabs__link> EVA Library </a> </li> <li class=md-tabs__item> <a href=../../book/ class=md-tabs__link> EVA Agentic Book </a> </li> <li class=md-tabs__item> <a href=../../eva-sovereign-ui-book/00-introduction/ class=md-tabs__link> EVA Sovereign UI Book </a> </li> <li class=md-tabs__item> <a href=../../compliance/ class=md-tabs__link> Compliance </a> </li> <li class=md-tabs__item> <a href=../../architecture/roadmap.md class=md-tabs__link> Architecture </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="EVA Suite" class="md-nav__button md-logo" aria-label="EVA Suite" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> EVA Suite </label> <div class=md-nav__source> <a href=https://github.com/MarcoPolo483/eva-orchestrator title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> eva-orchestrator </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> EVA Library </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> EVA Library </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eva-library/ class=md-nav__link> <span class=md-ellipsis> Overview </span> <span class="md-status md-status--production"></span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eva-library/components/button.md class=md-nav__link> <span class=md-ellipsis> Button </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/input.md class=md-nav__link> <span class=md-ellipsis> Input </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/select.md class=md-nav__link> <span class=md-ellipsis> Select </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/checkbox.md class=md-nav__link> <span class=md-ellipsis> Checkbox </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/radio.md class=md-nav__link> <span class=md-ellipsis> Radio </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/modal.md class=md-nav__link> <span class=md-ellipsis> Modal </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/tabs.md class=md-nav__link> <span class=md-ellipsis> Tabs </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/card.md class=md-nav__link> <span class=md-ellipsis> Card </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/alert.md class=md-nav__link> <span class=md-ellipsis> Alert </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/components/chat-panel.md class=md-nav__link> <span class=md-ellipsis> Chat Panel </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex> <span class=md-ellipsis> Framework Integration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Framework Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eva-library/frameworks/react.md class=md-nav__link> <span class=md-ellipsis> React </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/frameworks/vue.md class=md-nav__link> <span class=md-ellipsis> Vue </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/frameworks/angular.md class=md-nav__link> <span class=md-ellipsis> Angular </span> </a> </li> <li class=md-nav__item> <a href=../../eva-library/frameworks/svelte.md class=md-nav__link> <span class=md-ellipsis> Svelte </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> EVA Agentic Book </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> EVA Agentic Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../book/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/00-front-matter/ class=md-nav__link> <span class=md-ellipsis> Front Matter </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/01-introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/02-eva-philosophy/ class=md-nav__link> <span class=md-ellipsis> EVA Philosophy </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/03-pods-lifecycle/ class=md-nav__link> <span class=md-ellipsis> Pods & Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/04-safety-governance/ class=md-nav__link> <span class=md-ellipsis> Safety & Governance </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/05-eva-universe/ class=md-nav__link> <span class=md-ellipsis> EVA Universe - The Complete Vision </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/06-orchestration/ class=md-nav__link> <span class=md-ellipsis> Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/07-workflows/ class=md-nav__link> <span class=md-ellipsis> Workflows </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/08-agent-handbook/ class=md-nav__link> <span class=md-ellipsis> Agent Handbook </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/09-provenance-fingerprinting/ class=md-nav__link> <span class=md-ellipsis> Provenance & Fingerprinting </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/10-case-studies/ class=md-nav__link> <span class=md-ellipsis> Case Studies </span> </a> </li> <li class=md-nav__item> <a href=../../eva-agentic-book/11-appendices/ class=md-nav__link> <span class=md-ellipsis> Appendices </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_14> <label class=md-nav__link for=__nav_3_14 id=__nav_3_14_label tabindex> <span class=md-ellipsis> GC Agentic AI Framework </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_14_label aria-expanded=false> <label class=md-nav__title for=__nav_3_14> <span class="md-nav__icon md-icon"></span> GC Agentic AI Framework </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agentic/EVA%20Canada%20Agentic%20AI%20Template%20vol0%20-%20how-to/ class=md-nav__link> <span class=md-ellipsis> Volume 0 - Overview & How-To </span> </a> </li> <li class=md-nav__item> <a href=../../agentic/EVA%20Canada%20Agentic%20AI%20Template%20vol1/ class=md-nav__link> <span class=md-ellipsis> Volume 1 - Platform & Requirements </span> </a> </li> <li class=md-nav__item> <a href=../../agentic/EVA%20Canada%20Agentic%20AI%20Template%20vol2/ class=md-nav__link> <span class=md-ellipsis> Volume 2 - Engineering & Delivery </span> </a> </li> <li class=md-nav__item> <a href=../../agentic/EVA%20Canada%20Agentic%20AI%20Template%20vol3/ class=md-nav__link> <span class=md-ellipsis> Volume 3 - LiveOps & Governance </span> </a> </li> <li class=md-nav__item> <a href=../../agentic/EVA%20Canada%20Agentic%20AI%20Template%20vol4/ class=md-nav__link> <span class=md-ellipsis> Volume 4 - Use Cases & Patterns </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_15> <label class=md-nav__link for=__nav_3_15 id=__nav_3_15_label tabindex> <span class=md-ellipsis> DevTools Patterns (P01-P22) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_15_label aria-expanded=false> <label class=md-nav__title for=__nav_3_15> <span class="md-nav__icon md-icon"></span> DevTools Patterns (P01-P22) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agents/devtools/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P01-Agent-Patterns-Toolbox/ class=md-nav__link> <span class=md-ellipsis> P01 - Agent Patterns Toolbox </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P02-Requirements-Engine/ class=md-nav__link> <span class=md-ellipsis> P02 - Requirements Engine </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P03-Scrum-Agent/ class=md-nav__link> <span class=md-ellipsis> P03 - Scrum Agent </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P04-Repo-Librarian/ class=md-nav__link> <span class=md-ellipsis> P04 - Repo Librarian </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P05-Scaffolder-Agent/ class=md-nav__link> <span class=md-ellipsis> P05 - Scaffolder Agent </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P06-Review-Agent/ class=md-nav__link> <span class=md-ellipsis> P06 - Review Agent </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P07-Testing-Failure-Explainer/ class=md-nav__link> <span class=md-ellipsis> P07 - Testing & Failure Explainer </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P08-CICD-Guardian/ class=md-nav__link> <span class=md-ellipsis> P08 - CI/CD Guardian </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P09-Runbook-SRE-Agent/ class=md-nav__link> <span class=md-ellipsis> P09 - Runbook & SRE Agent </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P10-Metrics-Insight-Agent/ class=md-nav__link> <span class=md-ellipsis> P10 - Metrics & Insight Agent </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P11-Security-Compliance-Helper/ class=md-nav__link> <span class=md-ellipsis> P11 - Security & Compliance Helper </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P12-UX-Copy-Accessibility-Agent/ class=md-nav__link> <span class=md-ellipsis> P12 - UX, Copy & Accessibility Agent </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P13-Onboarding-Sandbox-Coach/ class=md-nav__link> <span class=md-ellipsis> P13 - Onboarding & Sandbox Coach </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P14-DevOps-LiveOps-Companion/ class=md-nav__link> <span class=md-ellipsis> P14 - DevOps LiveOps Companion </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P15-Dev-Master-Orchestrator/ class=md-nav__link> <span class=md-ellipsis> P15 - Dev Master Orchestrator </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P16-Awareness-Protocol/ class=md-nav__link> <span class=md-ellipsis> P16 - Awareness Protocol </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P17-Swarm-PR-Review/ class=md-nav__link> <span class=md-ellipsis> P17 - Swarm PR Review </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P18-Tool-API-Auto-Onboarding/ class=md-nav__link> <span class=md-ellipsis> P18 - Tool/API Auto-Onboarding </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P19-Action-Classification-Safety/ class=md-nav__link> <span class=md-ellipsis> P19 - Action Classification & Safety </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P20-Continuous-Self-Improvement/ class=md-nav__link> <span class=md-ellipsis> P20 - Continuous Self-Improvement </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P21-Provenance-Fingerprinting/ class=md-nav__link> <span class=md-ellipsis> P21 - Provenance & Fingerprinting </span> </a> </li> <li class=md-nav__item> <a href=../../agents/devtools/P22-Documentation-Publishing-Bot/ class=md-nav__link> <span class=md-ellipsis> P22 - Documentation Publishing Bot </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_16> <label class=md-nav__link for=__nav_3_16 id=__nav_3_16_label tabindex> <span class=md-ellipsis> Service Personas (SP00-SP02) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_16_label aria-expanded=false> <label class=md-nav__title for=__nav_3_16> <span class="md-nav__icon md-icon"></span> Service Personas (SP00-SP02) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../agents/personas/SP00-Senior-Advisor/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../agents/personas/SP01-Data-Ingestion/ class=md-nav__link> <span class=md-ellipsis> SP01 - Data Ingestion </span> </a> </li> <li class=md-nav__item> <a href=../../agents/personas/SP02-ATO-Auditor/ class=md-nav__link> <span class=md-ellipsis> SP02 - ATO Auditor </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> EVA Sovereign UI Book </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> EVA Sovereign UI Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/00-introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/01-getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/02-design-principles/ class=md-nav__link> <span class=md-ellipsis> Design Principles </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/03-components-overview/ class=md-nav__link> <span class=md-ellipsis> Components Overview </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/04-api-reference/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/05-usage-examples/ class=md-nav__link> <span class=md-ellipsis> Usage Examples </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/06-accessibility/ class=md-nav__link> <span class=md-ellipsis> Accessibility </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/07-internationalization/ class=md-nav__link> <span class=md-ellipsis> Internationalization </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/08-theming/ class=md-nav__link> <span class=md-ellipsis> Theming </span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/09-contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> <span class="md-status md-status--published"></span> </a> </li> <li class=md-nav__item> <a href=../../eva-sovereign-ui-book/10-appendices/ class=md-nav__link> <span class=md-ellipsis> Appendices </span> <span class="md-status md-status--published"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Compliance </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Compliance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../compliance/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../architecture/roadmap.md class=md-nav__link> <span class=md-ellipsis> Product Roadmap </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-vision-business-value class=md-nav__link> <span class=md-ellipsis> 1. Vision &amp; Business Value </span> </a> <nav class=md-nav aria-label="1. Vision & Business Value"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-this-service-delivers class=md-nav__link> <span class=md-ellipsis> What This Service Delivers </span> </a> </li> <li class=md-nav__item> <a href=#success-metrics class=md-nav__link> <span class=md-ellipsis> Success Metrics </span> </a> </li> <li class=md-nav__item> <a href=#business-impact class=md-nav__link> <span class=md-ellipsis> Business Impact </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-architecture-overview class=md-nav__link> <span class=md-ellipsis> 2. Architecture Overview </span> </a> <nav class=md-nav aria-label="2. Architecture Overview"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shared-infrastructure-model-approved-by-marco class=md-nav__link> <span class=md-ellipsis> Shared Infrastructure Model (Approved by Marco) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-technical-stack class=md-nav__link> <span class=md-ellipsis> 3. Technical Stack </span> </a> <nav class=md-nav aria-label="3. Technical Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#primary-technologies class=md-nav__link> <span class=md-ellipsis> Primary Technologies </span> </a> </li> <li class=md-nav__item> <a href=#terraform-module-structure class=md-nav__link> <span class=md-ellipsis> Terraform Module Structure </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-terraform-modules-specification class=md-nav__link> <span class=md-ellipsis> 4. Terraform Modules Specification </span> </a> <nav class=md-nav aria-label="4. Terraform Modules Specification"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-cosmos-db-module class=md-nav__link> <span class=md-ellipsis> 4.1 Cosmos DB Module </span> </a> </li> <li class=md-nav__item> <a href=#42-azure-ai-search-module class=md-nav__link> <span class=md-ellipsis> 4.2 Azure AI Search Module </span> </a> </li> <li class=md-nav__item> <a href=#43-azure-openai-module class=md-nav__link> <span class=md-ellipsis> 4.3 Azure OpenAI Module </span> </a> </li> <li class=md-nav__item> <a href=#44-blob-storage-module class=md-nav__link> <span class=md-ellipsis> 4.4 Blob Storage Module </span> </a> </li> <li class=md-nav__item> <a href=#45-redis-module class=md-nav__link> <span class=md-ellipsis> 4.5 Redis Module </span> </a> </li> <li class=md-nav__item> <a href=#46-key-vault-module class=md-nav__link> <span class=md-ellipsis> 4.6 Key Vault Module </span> </a> </li> <li class=md-nav__item> <a href=#47-networking-module class=md-nav__link> <span class=md-ellipsis> 4.7 Networking Module </span> </a> </li> <li class=md-nav__item> <a href=#48-monitoring-module class=md-nav__link> <span class=md-ellipsis> 4.8 Monitoring Module </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-cicd-workflows class=md-nav__link> <span class=md-ellipsis> 5. CI/CD Workflows </span> </a> <nav class=md-nav aria-label="5. CI/CD Workflows"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-terraform-plan-workflow class=md-nav__link> <span class=md-ellipsis> 5.1 Terraform Plan Workflow </span> </a> </li> <li class=md-nav__item> <a href=#52-terraform-apply-workflow class=md-nav__link> <span class=md-ellipsis> 5.2 Terraform Apply Workflow </span> </a> </li> <li class=md-nav__item> <a href=#53-terraform-destroy-workflow class=md-nav__link> <span class=md-ellipsis> 5.3 Terraform Destroy Workflow </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-quality-gates-all-must-pass class=md-nav__link> <span class=md-ellipsis> 6. Quality Gates (All Must Pass) </span> </a> <nav class=md-nav aria-label="6. Quality Gates (All Must Pass)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-terraform-validation-100 class=md-nav__link> <span class=md-ellipsis> 1. Terraform Validation: 100% </span> </a> </li> <li class=md-nav__item> <a href=#2-security-scan-zero-highcritical-issues class=md-nav__link> <span class=md-ellipsis> 2. Security Scan: Zero High/Critical Issues </span> </a> </li> <li class=md-nav__item> <a href=#3-cost-estimation-40month class=md-nav__link> <span class=md-ellipsis> 3. Cost Estimation: &lt; $40/month </span> </a> </li> <li class=md-nav__item> <a href=#4-deployment-success-100 class=md-nav__link> <span class=md-ellipsis> 4. Deployment Success: 100% </span> </a> </li> <li class=md-nav__item> <a href=#5-smoke-tests-100-pass class=md-nav__link> <span class=md-ellipsis> 5. Smoke Tests: 100% Pass </span> </a> </li> <li class=md-nav__item> <a href=#6-state-consistency-no-drift class=md-nav__link> <span class=md-ellipsis> 6. State Consistency: No Drift </span> </a> </li> <li class=md-nav__item> <a href=#7-backup-restore-100-success class=md-nav__link> <span class=md-ellipsis> 7. Backup &amp; Restore: 100% Success </span> </a> </li> <li class=md-nav__item> <a href=#8-documentation-100-complete class=md-nav__link> <span class=md-ellipsis> 8. Documentation: 100% Complete </span> </a> </li> <li class=md-nav__item> <a href=#9-secrets-management-zero-secrets-in-code class=md-nav__link> <span class=md-ellipsis> 9. Secrets Management: Zero Secrets in Code </span> </a> </li> <li class=md-nav__item> <a href=#10-multi-environment-isolation-100 class=md-nav__link> <span class=md-ellipsis> 10. Multi-Environment Isolation: 100% </span> </a> </li> <li class=md-nav__item> <a href=#11-rollback-success-5-minutes class=md-nav__link> <span class=md-ellipsis> 11. Rollback Success: &lt; 5 minutes </span> </a> </li> <li class=md-nav__item> <a href=#12-monitoring-alerts-100-functional class=md-nav__link> <span class=md-ellipsis> 12. Monitoring Alerts: 100% Functional </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-implementation-phases-4-phases-6-weeks class=md-nav__link> <span class=md-ellipsis> 7. Implementation Phases (4 Phases, 6 Weeks) </span> </a> <nav class=md-nav aria-label="7. Implementation Phases (4 Phases, 6 Weeks)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#phase-1-core-infrastructure-weeks-1-2 class=md-nav__link> <span class=md-ellipsis> Phase 1: Core Infrastructure (Weeks 1-2) </span> </a> </li> <li class=md-nav__item> <a href=#phase-2-ai-services-weeks-3-4 class=md-nav__link> <span class=md-ellipsis> Phase 2: AI Services (Weeks 3-4) </span> </a> </li> <li class=md-nav__item> <a href=#phase-3-networking-security-week-5 class=md-nav__link> <span class=md-ellipsis> Phase 3: Networking &amp; Security (Week 5) </span> </a> </li> <li class=md-nav__item> <a href=#phase-4-monitoring-docs-week-6 class=md-nav__link> <span class=md-ellipsis> Phase 4: Monitoring &amp; Docs (Week 6) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-references class=md-nav__link> <span class=md-ellipsis> 8. References </span> </a> <nav class=md-nav aria-label="8. References"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#terraform-azure-patterns class=md-nav__link> <span class=md-ellipsis> Terraform Azure Patterns </span> </a> </li> <li class=md-nav__item> <a href=#reference-implementations class=md-nav__link> <span class=md-ellipsis> Reference Implementations </span> </a> </li> <li class=md-nav__item> <a href=#azure-services class=md-nav__link> <span class=md-ellipsis> Azure Services </span> </a> </li> <li class=md-nav__item> <a href=#cost-optimization class=md-nav__link> <span class=md-ellipsis> Cost Optimization </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-next-steps class=md-nav__link> <span class=md-ellipsis> 9. Next Steps </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=eva-infrastructure-as-code-eva-infra>EVA Infrastructure as Code (eva-infra)<a class=headerlink href=#eva-infrastructure-as-code-eva-infra title="Permanent link">&para;</a></h1> <p><strong>Comprehensive Specification for Autonomous Implementation</strong></p> <hr> <h2 id=1-vision-business-value>1. Vision &amp; Business Value<a class=headerlink href=#1-vision-business-value title="Permanent link">&para;</a></h2> <h3 id=what-this-service-delivers>What This Service Delivers<a class=headerlink href=#what-this-service-delivers title="Permanent link">&para;</a></h3> <p>EVA-Infra provides <strong>Infrastructure as Code (IaC)</strong> for the entire EVA Suite using Terraform on Azure:</p> <ul> <li><strong>Azure Resources</strong>: Cosmos DB, Azure AI Search, Azure OpenAI, Blob Storage, Redis Cache, Key Vault</li> <li><strong>Networking</strong>: VNet, subnets, private endpoints, NSGs, DDoS protection (optional)</li> <li><strong>Security</strong>: Managed identities, Key Vault secrets, RBAC roles, private networking</li> <li><strong>Monitoring</strong>: Application Insights, Log Analytics workspace, alerts, cost tracking</li> <li><strong>Environments</strong>: Dev, Test, Prod (shared infrastructure model with logical isolation)</li> <li><strong>CI/CD</strong>: GitHub Actions workflows for plan, apply, destroy with approval gates</li> </ul> <h3 id=success-metrics>Success Metrics<a class=headerlink href=#success-metrics title="Permanent link">&para;</a></h3> <ul> <li><strong>Deployment Success Rate</strong>: 100% (all resources provisioned without manual intervention)</li> <li><strong>Deployment Time</strong>: &lt; 30 minutes for full environment (dev/test/prod)</li> <li><strong>Cost Control</strong>: $36/month baseline (vs $99 for separate environments)</li> <li><strong>Security Compliance</strong>: 100% resources with private endpoints (no public access in prod)</li> <li><strong>Reproducibility</strong>: <code>terraform destroy</code> + <code>terraform apply</code> creates identical environment</li> </ul> <h3 id=business-impact>Business Impact<a class=headerlink href=#business-impact title="Permanent link">&para;</a></h3> <ul> <li><strong>Offline Resilience</strong>: Marco's laptop can run everything locally (LocalStack for Azure emulation)</li> <li><strong>Multi-Tenant Isolation</strong>: Complete data isolation via Cosmos DB containers + resource groups</li> <li><strong>Cost Transparency</strong>: Azure Cost Management tags track spending per service</li> <li><strong>Rapid Provisioning</strong>: New client environment in &lt; 30 minutes (vs days of manual setup)</li> </ul> <hr> <h2 id=2-architecture-overview>2. Architecture Overview<a class=headerlink href=#2-architecture-overview title="Permanent link">&para;</a></h2> <h3 id=shared-infrastructure-model-approved-by-marco>Shared Infrastructure Model (Approved by Marco)<a class=headerlink href=#shared-infrastructure-model-approved-by-marco title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>┌──────────────────────────────────────────────────────────────────┐
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>│                   Azure Resource Group (eva-suite-rg)            │
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>│                                                                  │
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>│  │ Azure Static Web App (marcopolo483-eva-suite)              │ │
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>│  │  ├─ /dev/*  (branch: dev, env vars: DEV_*)                 │ │
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>│  │  ├─ /test/* (branch: test, env vars: TEST_*)               │ │
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>│  │  └─ /prod/* (branch: main, env vars: PROD_*)               │ │
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>│                                                                  │
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>│  │ Azure Cosmos DB (eva-suite-cosmos)                          │ │
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>│  │  ├─ dev-data  (400 RU/s, TTL: 7 days)                     │ │
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>│  │  ├─ test-data (400 RU/s, TTL: 30 days)                    │ │
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>│  │  └─ prod-data (1000 RU/s, no TTL, backup enabled)         │ │
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>│                                                                  │
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>│  │ Azure AI Search (eva-suite-search)                          │ │
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>│  │  ├─ dev-index  (Basic SKU, 50MB storage)                   │ │
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>│  │  ├─ test-index (Basic SKU, 50MB storage)                   │ │
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>│  │  └─ prod-index (Standard SKU, 100GB storage)               │ │
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>│                                                                  │
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>│  │ Azure OpenAI (eva-suite-openai)                             │ │
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>│  │  ├─ gpt-4o (shared across all environments)                │ │
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>│  │  ├─ text-embedding-3-small (shared, rate limits enforced)  │ │
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>│  │  └─ Usage tracked per environment via metadata tags        │ │
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>│                                                                  │
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>│  │ Azure Blob Storage (evasuitestorage)                        │ │
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a>│  │  ├─ dev-docs    (LRS, 30-day lifecycle)                    │ │
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>│  │  ├─ test-docs   (LRS, 90-day lifecycle)                    │ │
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a>│  │  └─ prod-docs   (GRS, immutable blobs, legal hold)         │ │
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>│                                                                  │
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>│  │ Azure Cache for Redis (eva-suite-redis)                     │ │
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>│  │  ├─ dev-cache  (Basic C0, 250MB)                           │ │
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>│  │  ├─ test-cache (Basic C0, 250MB)                           │ │
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>│  │  └─ prod-cache (Standard C1, 1GB, Redis persistence)       │ │
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a>│                                                                  │
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>│  │ Azure Key Vault (eva-suite-kv)                              │ │
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>│  │  ├─ Cosmos connection strings (dev/test/prod)              │ │
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a>│  │  ├─ Azure OpenAI keys                                       │ │
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>│  │  ├─ Blob Storage keys                                       │ │
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>│  │  └─ JWT signing secrets                                     │ │
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>│                                                                  │
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a>│  ┌────────────────────────────────────────────────────────────┐ │
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a>│  │ Monitoring &amp; Logging                                        │ │
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a>│  │  ├─ Log Analytics Workspace (90-day retention)             │ │
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a>│  │  ├─ Application Insights (distributed tracing)             │ │
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>│  │  └─ Azure Cost Management (budget alerts at $40/month)     │ │
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a>│  └────────────────────────────────────────────────────────────┘ │
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a>└──────────────────────────────────────────────────────────────────┘
</span></code></pre></div> <p><strong>Benefits:</strong> - <strong>64% Cost Reduction</strong>: $36/month vs $99 (separate environments) - <strong>Unified DNS</strong>: <code>eva-suite.marcopolo483.dev</code> (single SSL certificate) - <strong>Shared Authentication</strong>: Azure AD B2C tenant across all environments - <strong>Environment Routing</strong>: Path-based (/dev, /test, /prod) or subdomain-based</p> <hr> <h2 id=3-technical-stack>3. Technical Stack<a class=headerlink href=#3-technical-stack title="Permanent link">&para;</a></h2> <h3 id=primary-technologies>Primary Technologies<a class=headerlink href=#primary-technologies title="Permanent link">&para;</a></h3> <ul> <li><strong>IaC Tool</strong>: Terraform 1.6+ (HashiCorp Configuration Language - HCL)</li> <li><strong>Provider</strong>: AzureRM 3.x+ (Azure Resource Manager)</li> <li><strong>State Backend</strong>: Azure Blob Storage (remote state with locking)</li> <li><strong>CI/CD</strong>: GitHub Actions (terraform plan, apply, destroy workflows)</li> <li><strong>Secrets</strong>: Azure Key Vault (connection strings, API keys, JWT secrets)</li> <li><strong>Monitoring</strong>: Azure Monitor, Application Insights, Log Analytics</li> </ul> <h3 id=terraform-module-structure>Terraform Module Structure<a class=headerlink href=#terraform-module-structure title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>eva-infra/
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>├── terraform/
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>│   ├── main.tf                  # Root module (calls child modules)
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>│   ├── variables.tf             # Input variables (environment, region, SKUs)
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>│   ├── outputs.tf               # Exported values (connection strings, endpoints)
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>│   ├── providers.tf             # Azure RM provider configuration
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>│   ├── backend.tf               # Remote state configuration
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>│   ├── versions.tf              # Terraform + provider version constraints
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>│   │
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>│   ├── modules/
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>│   │   ├── cosmos-db/           # Cosmos DB account + containers
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>│   │   │   ├── main.tf
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>│   │   │   ├── variables.tf
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>│   │   │   └── outputs.tf
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>│   │   │
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>│   │   ├── ai-search/           # Azure AI Search service + indexes
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>│   │   │   ├── main.tf
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>│   │   │   ├── variables.tf
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>│   │   │   └── outputs.tf
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>│   │   │
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>│   │   ├── openai/              # Azure OpenAI account + deployments
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>│   │   │   ├── main.tf
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>│   │   │   ├── variables.tf
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>│   │   │   └── outputs.tf
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>│   │   │
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a>│   │   ├── storage/             # Blob Storage account + containers
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a>│   │   │   ├── main.tf
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>│   │   │   ├── variables.tf
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>│   │   │   └── outputs.tf
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>│   │   │
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>│   │   ├── redis/               # Azure Cache for Redis
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a>│   │   │   ├── main.tf
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a>│   │   │   ├── variables.tf
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>│   │   │   └── outputs.tf
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a>│   │   │
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a>│   │   ├── key-vault/           # Key Vault + secrets
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a>│   │   │   ├── main.tf
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>│   │   │   ├── variables.tf
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a>│   │   │   └── outputs.tf
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a>│   │   │
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a>│   │   ├── networking/          # VNet, subnets, NSGs, private endpoints
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a>│   │   │   ├── main.tf
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a>│   │   │   ├── variables.tf
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a>│   │   │   └── outputs.tf
</span><span id=__span-1-45><a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a>│   │   │
</span><span id=__span-1-46><a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a>│   │   └── monitoring/          # Log Analytics, Application Insights
</span><span id=__span-1-47><a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a>│   │       ├── main.tf
</span><span id=__span-1-48><a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a>│   │       ├── variables.tf
</span><span id=__span-1-49><a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a>│   │       └── outputs.tf
</span><span id=__span-1-50><a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a>│   │
</span><span id=__span-1-51><a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a>│   ├── environments/
</span><span id=__span-1-52><a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a>│   │   ├── dev.tfvars           # Dev-specific values (RU/s, SKUs)
</span><span id=__span-1-53><a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a>│   │   ├── test.tfvars          # Test-specific values
</span><span id=__span-1-54><a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a>│   │   └── prod.tfvars          # Prod-specific values
</span><span id=__span-1-55><a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a>│   │
</span><span id=__span-1-56><a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a>│   └── scripts/
</span><span id=__span-1-57><a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a>│       ├── plan.sh              # Terraform plan wrapper
</span><span id=__span-1-58><a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a>│       ├── apply.sh             # Terraform apply wrapper
</span><span id=__span-1-59><a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a>│       ├── destroy.sh           # Terraform destroy wrapper
</span><span id=__span-1-60><a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a>│       └── smoke-test.sh        # Post-deployment validation
</span><span id=__span-1-61><a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a>│
</span><span id=__span-1-62><a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a>├── .github/
</span><span id=__span-1-63><a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a>│   └── workflows/
</span><span id=__span-1-64><a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a>│       ├── terraform-plan.yml   # PR workflow (plan + validate)
</span><span id=__span-1-65><a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a>│       ├── terraform-apply.yml  # Merge workflow (apply with approval)
</span><span id=__span-1-66><a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a>│       └── terraform-destroy.yml # Manual workflow (destroy environment)
</span><span id=__span-1-67><a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a>│
</span><span id=__span-1-68><a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a>└── docs/
</span><span id=__span-1-69><a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a>    ├── SPECIFICATION.md         # This document
</span><span id=__span-1-70><a id=__codelineno-1-70 name=__codelineno-1-70 href=#__codelineno-1-70></a>    ├── PROVISIONING.md          # Step-by-step deployment guide
</span><span id=__span-1-71><a id=__codelineno-1-71 name=__codelineno-1-71 href=#__codelineno-1-71></a>    ├── ROLLBACK.md              # Disaster recovery procedures
</span><span id=__span-1-72><a id=__codelineno-1-72 name=__codelineno-1-72 href=#__codelineno-1-72></a>    └── COST-OPTIMIZATION.md     # Strategies to reduce Azure costs
</span></code></pre></div> <hr> <h2 id=4-terraform-modules-specification>4. Terraform Modules Specification<a class=headerlink href=#4-terraform-modules-specification title="Permanent link">&para;</a></h2> <h3 id=41-cosmos-db-module>4.1 Cosmos DB Module<a class=headerlink href=#41-cosmos-db-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/cosmos-db/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_cosmosdb_account</code>: Cosmos DB account (serverless or provisioned) - <code>azurerm_cosmosdb_sql_database</code>: SQL API database (<code>eva-suite-db</code>) - <code>azurerm_cosmosdb_sql_container</code>: Containers per environment (dev-data, test-data, prod-data) - <code>azurerm_private_endpoint</code>: Private endpoint for VNet integration (prod only)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_cosmosdb_account&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-cosmos-${var.environment}&quot;</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>  </span><span class=na>offer_type</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Standard&quot;</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>  </span><span class=na>kind</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GlobalDocumentDB&quot;</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>  </span><span class=nb>consistency_policy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=na>consistency_level</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Session&quot;</span><span class=c1> # Balance between performance and consistency</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>  </span><span class=nb>geo_location</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=w>    </span><span class=na>location</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=w>    </span><span class=na>failover_priority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=w>  </span><span class=nb>capabilities</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a><span class=w>    </span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;EnableServerless&quot; # or &quot;EnableProvisionedThroughput&quot;</span><span class=w> </span><span class=err>for</span><span class=w> </span><span class=err>prod</span>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a><span class=w>  </span><span class=nb>backup</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a><span class=w>    </span><span class=na>type</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot; ? &quot;Continuous&quot; : &quot;Periodic&quot;</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a><span class=w>    </span><span class=na>interval_in_minutes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=kt>null</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>240</span><span class=c1> # 4 hours for dev/test</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a><span class=w>    </span><span class=na>retention_in_hours</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=kt>null</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>168</span><span class=c1> # 7 days for dev/test</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a><span class=w>  </span><span class=na>public_network_access_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=no>false</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a><span class=p>}</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_cosmosdb_sql_database&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite_db&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-db&quot;</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a><span class=w>  </span><span class=na>account_name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_cosmosdb_account.eva_suite.name</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a><span class=p>}</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_cosmosdb_sql_container&quot;</span><span class=w> </span><span class=nv>&quot;data&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.environment}-data&quot;</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a><span class=w>  </span><span class=na>account_name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_cosmosdb_account.eva_suite.name</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a><span class=w>  </span><span class=na>database_name</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_cosmosdb_sql_database.eva_suite_db.name</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a><span class=w>  </span><span class=na>partition_key_path</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/tenantId&quot;</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a><span class=w>  </span><span class=na>throughput</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>1000</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>400</span><span class=c1> # RU/s</span>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a><span class=w>  </span><span class=na>default_ttl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;dev&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>604800</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=err>-</span><span class=m>1</span><span class=c1> # 7 days for dev, infinite for prod</span>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a><span class=w>  </span><span class=nb>indexing_policy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a><span class=w>    </span><span class=na>indexing_mode</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;consistent&quot;</span>
</span><span id=__span-2-54><a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a>
</span><span id=__span-2-55><a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a><span class=w>    </span><span class=nb>included_path</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-56><a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a><span class=w>      </span><span class=na>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/*&quot;</span>
</span><span id=__span-2-57><a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-2-58><a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a>
</span><span id=__span-2-59><a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a><span class=w>    </span><span class=nb>excluded_path</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-60><a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a><span class=w>      </span><span class=na>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;/\&quot;_etag\&quot;/?&quot;</span>
</span><span id=__span-2-61><a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-2-62><a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-2-63><a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Outputs</strong>: - <code>cosmos_endpoint</code>: Cosmos DB endpoint URL - <code>cosmos_primary_key</code>: Primary read-write key (stored in Key Vault) - <code>cosmos_connection_string</code>: Full connection string (stored in Key Vault)</p> <hr> <h3 id=42-azure-ai-search-module>4.2 Azure AI Search Module<a class=headerlink href=#42-azure-ai-search-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/ai-search/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_search_service</code>: Azure AI Search service - <code>azurerm_search_index</code>: Vector index for embeddings (created via API, not Terraform) - <code>azurerm_private_endpoint</code>: Private endpoint for VNet integration (prod only)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_search_service&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-search-${var.environment}&quot;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>  </span><span class=na>sku</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot; ? &quot;standard&quot; : &quot;basic&quot;</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>  </span><span class=na>replica_count</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>  </span><span class=na>partition_count</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>  </span><span class=na>public_network_access_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=no>false</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=p>}</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=c1># Note: Azure AI Search index creation requires Azure CLI or REST API</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=c1># Cannot be managed by Terraform (use az search index create in scripts/)</span>
</span></code></pre></div></p> <p><strong>Outputs</strong>: - <code>search_endpoint</code>: AI Search endpoint URL - <code>search_admin_key</code>: Admin API key (stored in Key Vault) - <code>search_query_key</code>: Query-only API key (for read operations)</p> <hr> <h3 id=43-azure-openai-module>4.3 Azure OpenAI Module<a class=headerlink href=#43-azure-openai-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/openai/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_cognitive_account</code>: Azure OpenAI account - <code>azurerm_cognitive_deployment</code>: GPT-4o deployment - <code>azurerm_cognitive_deployment</code>: text-embedding-3-small deployment - <code>azurerm_private_endpoint</code>: Private endpoint for VNet integration (prod only)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_cognitive_account&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite_openai&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-openai-${var.environment}&quot;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>  </span><span class=na>kind</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;OpenAI&quot;</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>  </span><span class=na>sku_name</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;S0&quot;</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>  </span><span class=na>public_network_access_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=no>false</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=p>}</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_cognitive_deployment&quot;</span><span class=w> </span><span class=nv>&quot;gpt4o&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>  </span><span class=na>name</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gpt-4o&quot;</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>  </span><span class=na>cognitive_account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_cognitive_account.eva_suite_openai.id</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=w>  </span><span class=nb>model</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=w>    </span><span class=na>format</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;OpenAI&quot;</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>    </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;gpt-4o&quot;</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w>    </span><span class=na>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;2024-05-13&quot;</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=w>  </span><span class=nb>sku</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=w>    </span><span class=na>name</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Standard&quot;</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=w>    </span><span class=na>capacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>100</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=c1> # TPM (tokens per minute)</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a><span class=p>}</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_cognitive_deployment&quot;</span><span class=w> </span><span class=nv>&quot;embedding&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a><span class=w>  </span><span class=na>name</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;text-embedding-3-small&quot;</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=w>  </span><span class=na>cognitive_account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_cognitive_account.eva_suite_openai.id</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=w>  </span><span class=nb>model</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a><span class=w>    </span><span class=na>format</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;OpenAI&quot;</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a><span class=w>    </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;text-embedding-3-small&quot;</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a><span class=w>    </span><span class=na>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1&quot;</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a><span class=w>  </span><span class=nb>sku</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a><span class=w>    </span><span class=na>name</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Standard&quot;</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a><span class=w>    </span><span class=na>capacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>1000</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>500</span><span class=c1> # TPM</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Outputs</strong>: - <code>openai_endpoint</code>: Azure OpenAI endpoint URL - <code>openai_api_key</code>: API key (stored in Key Vault) - <code>gpt4o_deployment_name</code>: GPT-4o deployment name - <code>embedding_deployment_name</code>: Embedding model deployment name</p> <hr> <h3 id=44-blob-storage-module>4.4 Blob Storage Module<a class=headerlink href=#44-blob-storage-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/storage/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_storage_account</code>: Blob Storage account - <code>azurerm_storage_container</code>: Containers per environment (dev-docs, test-docs, prod-docs) - <code>azurerm_storage_management_policy</code>: Lifecycle management (auto-delete old blobs) - <code>azurerm_private_endpoint</code>: Private endpoint for VNet integration (prod only)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_storage_account&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>  </span><span class=na>name</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;evasuitestorage${var.environment}&quot;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>  </span><span class=na>location</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>  </span><span class=na>account_tier</span><span class=w>             </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Standard&quot;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>  </span><span class=na>account_replication_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot; ? &quot;GRS&quot; : &quot;LRS&quot;</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>  </span><span class=na>min_tls_version</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;TLS1_2&quot;</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>  </span><span class=na>https_traffic_only_enabled</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>  </span><span class=na>allow_nested_items_to_be_public</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>  </span><span class=nb>blob_properties</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=na>versioning_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>    </span><span class=nb>delete_retention_policy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>      </span><span class=na>days</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>90</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>7</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=p>}</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_storage_container&quot;</span><span class=w> </span><span class=nv>&quot;docs&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>  </span><span class=na>name</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;${var.environment}-docs&quot;</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>  </span><span class=na>storage_account_name</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_storage_account.eva_suite.name</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>  </span><span class=na>container_access_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;private&quot;</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=p>}</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_storage_management_policy&quot;</span><span class=w> </span><span class=nv>&quot;lifecycle&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=w>  </span><span class=na>storage_account_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_storage_account.eva_suite.id</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=w>  </span><span class=nb>rule</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w>    </span><span class=na>name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;delete-old-blobs&quot;</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=w>    </span><span class=na>enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a><span class=w>    </span><span class=nb>filters</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a><span class=w>      </span><span class=na>prefix_match</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;${var.environment}-docs/&quot;</span><span class=p>]</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=w>      </span><span class=na>blob_types</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;blockBlob&quot;</span><span class=p>]</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a><span class=w>    </span><span class=nb>actions</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a><span class=w>      </span><span class=nb>base_blob</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a><span class=w>        </span><span class=na>delete_after_days_since_modification_greater_than</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;dev&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>30</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>365</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a><span class=w>      </span><span class=p>}</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Outputs</strong>: - <code>storage_account_name</code>: Storage account name - <code>storage_primary_key</code>: Primary access key (stored in Key Vault) - <code>storage_connection_string</code>: Full connection string (stored in Key Vault)</p> <hr> <h3 id=45-redis-module>4.5 Redis Module<a class=headerlink href=#45-redis-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/redis/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_redis_cache</code>: Azure Cache for Redis - <code>azurerm_private_endpoint</code>: Private endpoint for VNet integration (prod only)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_redis_cache&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-redis-${var.environment}&quot;</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>  </span><span class=na>capacity</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=c1> # C1 for prod, C0 for dev/test</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>  </span><span class=na>family</span><span class=w>              </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot; ? &quot;C&quot; : &quot;C&quot;</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>  </span><span class=na>sku_name</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot; ? &quot;Standard&quot; : &quot;Basic&quot;</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>  </span><span class=na>enable_non_ssl_port</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>false</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>  </span><span class=na>minimum_tls_version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1.2&quot;</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>  </span><span class=nb>redis_configuration</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>    </span><span class=na>maxmemory_policy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;allkeys-lru&quot;</span><span class=c1> # Evict least recently used keys when memory full</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>  </span><span class=na>public_network_access_enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=no>false</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=no>true</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Outputs</strong>: - <code>redis_hostname</code>: Redis hostname - <code>redis_port</code>: Redis SSL port (6380) - <code>redis_primary_key</code>: Primary access key (stored in Key Vault)</p> <hr> <h3 id=46-key-vault-module>4.6 Key Vault Module<a class=headerlink href=#46-key-vault-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/key-vault/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_key_vault</code>: Key Vault for secrets - <code>azurerm_key_vault_secret</code>: Secrets for connection strings, API keys - <code>azurerm_private_endpoint</code>: Private endpoint for VNet integration (prod only)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kr>data</span><span class=w> </span><span class=nc>&quot;azurerm_client_config&quot;</span><span class=w> </span><span class=nv>&quot;current&quot;</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_key_vault&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-kv-${var.environment}&quot;</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>  </span><span class=na>tenant_id</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=nv>data.azurerm_client_config.current.tenant_id</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>  </span><span class=na>sku_name</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;standard&quot;</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>  </span><span class=na>enable_rbac_authorization</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span><span class=c1> # Use RBAC instead of access policies</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>  </span><span class=nb>network_acls</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>    </span><span class=na>default_action</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot; ? &quot;Deny&quot; : &quot;Allow&quot;</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>    </span><span class=na>bypass</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;AzureServices&quot;</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=p>}</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=c1># Example secret: Cosmos DB connection string</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_key_vault_secret&quot;</span><span class=w> </span><span class=nv>&quot;cosmos_connection_string&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>  </span><span class=na>name</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;cosmos-connection-string&quot;</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>  </span><span class=na>value</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.cosmos_connection_string</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>  </span><span class=na>key_vault_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_key_vault.eva_suite.id</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>  </span><span class=na>depends_on</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=nv>azurerm_key_vault.eva_suite</span><span class=p>]</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=p>}</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=c1># Grant Terraform service principal read access</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_role_assignment&quot;</span><span class=w> </span><span class=nv>&quot;terraform_kv_secrets_user&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=w>  </span><span class=na>scope</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_key_vault.eva_suite.id</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>  </span><span class=na>role_definition_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Key Vault Secrets User&quot;</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=w>  </span><span class=na>principal_id</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=nv>data.azurerm_client_config.current.object_id</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Outputs</strong>: - <code>key_vault_id</code>: Key Vault resource ID - <code>key_vault_uri</code>: Key Vault URI (<code>https://eva-suite-kv-prod.vault.azure.net/</code>)</p> <hr> <h3 id=47-networking-module>4.7 Networking Module<a class=headerlink href=#47-networking-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/networking/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_virtual_network</code>: VNet for private networking - <code>azurerm_subnet</code>: Subnets for each service (Cosmos DB, AI Search, OpenAI, etc.) - <code>azurerm_network_security_group</code>: NSG with rules - <code>azurerm_private_dns_zone</code>: Private DNS zones for Azure services - <code>azurerm_private_endpoint</code>: Private endpoints for services</p> <p><strong>Configuration</strong> (prod only, dev/test use public endpoints): <div class="language-hcl highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_virtual_network&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>  </span><span class=na>count</span><span class=w>               </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-vnet&quot;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>  </span><span class=na>address_space</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;10.0.0.0/16&quot;</span><span class=p>]</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=p>}</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_subnet&quot;</span><span class=w> </span><span class=nv>&quot;cosmos&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=w>  </span><span class=na>count</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=w>  </span><span class=na>name</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;cosmos-subnet&quot;</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=w>  </span><span class=na>virtual_network_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_virtual_network.eva_suite[0].name</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=w>  </span><span class=na>address_prefixes</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;10.0.1.0/24&quot;</span><span class=p>]</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=w>  </span><span class=na>service_endpoints</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;Microsoft.AzureCosmosDB&quot;</span><span class=p>]</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=p>}</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_network_security_group&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=w>  </span><span class=na>count</span><span class=w>               </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-nsg&quot;</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=w>  </span><span class=nb>security_rule</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=w>    </span><span class=na>name</span><span class=w>                       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;AllowHTTPS&quot;</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=w>    </span><span class=na>priority</span><span class=w>                   </span><span class=o>=</span><span class=w> </span><span class=m>100</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=w>    </span><span class=na>direction</span><span class=w>                  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Inbound&quot;</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=w>    </span><span class=na>access</span><span class=w>                     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=w>    </span><span class=na>protocol</span><span class=w>                   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Tcp&quot;</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=w>    </span><span class=na>source_port_range</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;*&quot;</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=w>    </span><span class=na>destination_port_range</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;443&quot;</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=w>    </span><span class=na>source_address_prefix</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;*&quot;</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=w>    </span><span class=na>destination_address_prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;*&quot;</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a><span class=p>}</span>
</span></code></pre></div></p> <hr> <h3 id=48-monitoring-module>4.8 Monitoring Module<a class=headerlink href=#48-monitoring-module title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>modules/monitoring/main.tf</code></p> <p><strong>Resources Created</strong>: - <code>azurerm_log_analytics_workspace</code>: Log Analytics workspace - <code>azurerm_application_insights</code>: Application Insights for distributed tracing - <code>azurerm_monitor_action_group</code>: Alert action group (email/SMS) - <code>azurerm_monitor_metric_alert</code>: Cost alert (budget exceeded)</p> <p><strong>Configuration</strong>: <div class="language-hcl highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_log_analytics_workspace&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-logs-${var.environment}&quot;</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span><span class=na>sku</span><span class=w>                 </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;PerGB2018&quot;</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>  </span><span class=na>retention_in_days</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span><span class=w> </span><span class=p>==</span><span class=w> </span><span class=s2>&quot;prod&quot;</span><span class=w> </span><span class=p>?</span><span class=w> </span><span class=m>90</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=m>30</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=p>}</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_application_insights&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-insights-${var.environment}&quot;</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>  </span><span class=na>location</span><span class=w>            </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>  </span><span class=na>workspace_id</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_log_analytics_workspace.eva_suite.id</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>  </span><span class=na>application_type</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;web&quot;</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=p>}</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_monitor_action_group&quot;</span><span class=w> </span><span class=nv>&quot;eva_suite&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-alerts-${var.environment}&quot;</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a><span class=w>  </span><span class=na>short_name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;EVA Alerts&quot;</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a>
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a><span class=w>  </span><span class=nb>email_receiver</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a><span class=w>    </span><span class=na>name</span><span class=w>          </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Marco Presta&quot;</span>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a><span class=w>    </span><span class=na>email_address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.alert_email</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a><span class=p>}</span>
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;azurerm_monitor_metric_alert&quot;</span><span class=w> </span><span class=nv>&quot;cost_budget&quot;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a><span class=w>  </span><span class=na>name</span><span class=w>                </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;eva-suite-cost-alert-${var.environment}&quot;</span>
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a><span class=w>  </span><span class=na>resource_group_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.resource_group_name</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a><span class=w>  </span><span class=na>scopes</span><span class=w>              </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=nv>azurerm_resource_group.eva_suite.id</span><span class=p>]</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a><span class=w>  </span><span class=na>description</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Alert when monthly cost exceeds $40&quot;</span>
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a><span class=w>  </span><span class=nb>criteria</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a><span class=w>    </span><span class=na>metric_namespace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Microsoft.CostManagement/budgets&quot;</span>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a><span class=w>    </span><span class=na>metric_name</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;ActualCost&quot;</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a><span class=w>    </span><span class=na>aggregation</span><span class=w>      </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Total&quot;</span>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53 href=#__codelineno-9-53></a><span class=w>    </span><span class=na>operator</span><span class=w>         </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GreaterThan&quot;</span>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54 href=#__codelineno-9-54></a><span class=w>    </span><span class=na>threshold</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=m>40</span>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55 href=#__codelineno-9-55></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56 href=#__codelineno-9-56></a>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57 href=#__codelineno-9-57></a><span class=w>  </span><span class=nb>action</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58 href=#__codelineno-9-58></a><span class=w>    </span><span class=na>action_group_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>azurerm_monitor_action_group.eva_suite.id</span>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59 href=#__codelineno-9-59></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60 href=#__codelineno-9-60></a>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61 href=#__codelineno-9-61></a><span class=w>  </span><span class=na>tags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=nv>var.tags</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62 href=#__codelineno-9-62></a><span class=w>    </span><span class=na>Environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.environment</span>
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63 href=#__codelineno-9-63></a><span class=w>    </span><span class=na>ManagedBy</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Terraform&quot;</span>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64 href=#__codelineno-9-64></a><span class=w>  </span><span class=p>})</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65 href=#__codelineno-9-65></a><span class=p>}</span>
</span></code></pre></div></p> <hr> <h2 id=5-cicd-workflows>5. CI/CD Workflows<a class=headerlink href=#5-cicd-workflows title="Permanent link">&para;</a></h2> <h3 id=51-terraform-plan-workflow>5.1 Terraform Plan Workflow<a class=headerlink href=#51-terraform-plan-workflow title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>.github/workflows/terraform-plan.yml</code></p> <p><strong>Trigger</strong>: Pull request to <code>main</code> branch</p> <p><strong>Steps</strong>: 1. Checkout code 2. Setup Terraform 3. Terraform init (with remote backend) 4. Terraform validate 5. Terraform plan (for each environment: dev, test, prod) 6. Post plan output as PR comment 7. Security scan (tfsec)</p> <p><strong>Example</strong>: <div class="language-yaml highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=nt>on</span><span class=p>:</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>main</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=nt>paths</span><span class=p>:</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;terraform/**&#39;</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;.github/workflows/terraform-plan.yml&#39;</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=nt>jobs</span><span class=p>:</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span><span class=nt>plan</span><span class=p>:</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=nv>dev</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>test</span><span class="p p-Indicator">,</span><span class=w> </span><span class=nv>prod</span><span class="p p-Indicator">]</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>          </span><span class=nt>terraform_version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.6.0</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>          </span><span class=no>cd terraform</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>          </span><span class=no>terraform init \</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>            </span><span class=no>-backend-config=&quot;resource_group_name=${{ secrets.TFSTATE_RG }}&quot; \</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>            </span><span class=no>-backend-config=&quot;storage_account_name=${{ secrets.TFSTATE_SA }}&quot; \</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>            </span><span class=no>-backend-config=&quot;container_name=tfstate&quot; \</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>            </span><span class=no>-backend-config=&quot;key=${{ matrix.environment }}.tfstate&quot;</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>          </span><span class=nt>ARM_CLIENT_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_CLIENT_ID }}</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>          </span><span class=nt>ARM_CLIENT_SECRET</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_CLIENT_SECRET }}</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=w>          </span><span class=nt>ARM_SUBSCRIPTION_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_SUBSCRIPTION_ID }}</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>          </span><span class=nt>ARM_TENANT_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_TENANT_ID }}</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Validate</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=w>          </span><span class=no>cd terraform</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=w>          </span><span class=no>terraform validate</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a><span class=w>          </span><span class=no>cd terraform</span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a><span class=w>          </span><span class=no>terraform plan \</span>
</span><span id=__span-10-47><a id=__codelineno-10-47 name=__codelineno-10-47 href=#__codelineno-10-47></a><span class=w>            </span><span class=no>-var-file=&quot;environments/${{ matrix.environment }}.tfvars&quot; \</span>
</span><span id=__span-10-48><a id=__codelineno-10-48 name=__codelineno-10-48 href=#__codelineno-10-48></a><span class=w>            </span><span class=no>-out=tfplan-${{ matrix.environment }}</span>
</span><span id=__span-10-49><a id=__codelineno-10-49 name=__codelineno-10-49 href=#__codelineno-10-49></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
</span><span id=__span-10-50><a id=__codelineno-10-50 name=__codelineno-10-50 href=#__codelineno-10-50></a><span class=w>          </span><span class=nt>ARM_CLIENT_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_CLIENT_ID }}</span>
</span><span id=__span-10-51><a id=__codelineno-10-51 name=__codelineno-10-51 href=#__codelineno-10-51></a><span class=w>          </span><span class=nt>ARM_CLIENT_SECRET</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_CLIENT_SECRET }}</span>
</span><span id=__span-10-52><a id=__codelineno-10-52 name=__codelineno-10-52 href=#__codelineno-10-52></a><span class=w>          </span><span class=nt>ARM_SUBSCRIPTION_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_SUBSCRIPTION_ID }}</span>
</span><span id=__span-10-53><a id=__codelineno-10-53 name=__codelineno-10-53 href=#__codelineno-10-53></a><span class=w>          </span><span class=nt>ARM_TENANT_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ARM_TENANT_ID }}</span>
</span><span id=__span-10-54><a id=__codelineno-10-54 name=__codelineno-10-54 href=#__codelineno-10-54></a>
</span><span id=__span-10-55><a id=__codelineno-10-55 name=__codelineno-10-55 href=#__codelineno-10-55></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Security Scan</span>
</span><span id=__span-10-56><a id=__codelineno-10-56 name=__codelineno-10-56 href=#__codelineno-10-56></a><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/tfsec-action@v1.0.0</span>
</span><span id=__span-10-57><a id=__codelineno-10-57 name=__codelineno-10-57 href=#__codelineno-10-57></a><span class=w>        </span><span class=nt>with</span><span class=p>:</span>
</span><span id=__span-10-58><a id=__codelineno-10-58 name=__codelineno-10-58 href=#__codelineno-10-58></a><span class=w>          </span><span class=nt>working_directory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">terraform</span>
</span></code></pre></div></p> <hr> <h3 id=52-terraform-apply-workflow>5.2 Terraform Apply Workflow<a class=headerlink href=#52-terraform-apply-workflow title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>.github/workflows/terraform-apply.yml</code></p> <p><strong>Trigger</strong>: Push to <code>main</code> branch (after PR merge)</p> <p><strong>Approval Gate</strong>: Requires manual approval for prod environment</p> <p><strong>Steps</strong>: 1. Checkout code 2. Setup Terraform 3. Terraform init 4. Terraform apply (with auto-approve for dev/test, manual approval for prod) 5. Run smoke tests 6. Post deployment summary</p> <hr> <h3 id=53-terraform-destroy-workflow>5.3 Terraform Destroy Workflow<a class=headerlink href=#53-terraform-destroy-workflow title="Permanent link">&para;</a></h3> <p><strong>File</strong>: <code>.github/workflows/terraform-destroy.yml</code></p> <p><strong>Trigger</strong>: Manual workflow dispatch (only authorized users)</p> <p><strong>Steps</strong>: 1. Confirm environment to destroy (dev/test only, prod requires manual CLI) 2. Terraform destroy (with confirmation) 3. Clean up state files</p> <hr> <h2 id=6-quality-gates-all-must-pass>6. Quality Gates (All Must Pass)<a class=headerlink href=#6-quality-gates-all-must-pass title="Permanent link">&para;</a></h2> <h3 id=1-terraform-validation-100>1. Terraform Validation: 100%<a class=headerlink href=#1-terraform-validation-100 title="Permanent link">&para;</a></h3> <ul> <li><strong>Tool</strong>: <code>terraform validate</code></li> <li><strong>Command</strong>: <code>terraform validate</code></li> <li><strong>Target</strong>: Zero syntax errors</li> <li><strong>Evidence</strong>: CI/CD logs showing validation passed</li> </ul> <h3 id=2-security-scan-zero-highcritical-issues>2. Security Scan: Zero High/Critical Issues<a class=headerlink href=#2-security-scan-zero-highcritical-issues title="Permanent link">&para;</a></h3> <ul> <li><strong>Tool</strong>: tfsec (Terraform security scanner)</li> <li><strong>Command</strong>: <code>tfsec terraform/</code></li> <li><strong>Target</strong>: Zero high/critical vulnerabilities</li> <li><strong>Evidence</strong>: tfsec report</li> </ul> <h3 id=3-cost-estimation-40month>3. Cost Estimation: &lt; $40/month<a class=headerlink href=#3-cost-estimation-40month title="Permanent link">&para;</a></h3> <ul> <li><strong>Tool</strong>: Infracost (cost estimation for Terraform)</li> <li><strong>Command</strong>: <code>infracost breakdown --path terraform/</code></li> <li><strong>Target</strong>: &lt; $40/month for all environments</li> <li><strong>Evidence</strong>: Infracost report</li> </ul> <h3 id=4-deployment-success-100>4. Deployment Success: 100%<a class=headerlink href=#4-deployment-success-100 title="Permanent link">&para;</a></h3> <ul> <li><strong>Metric</strong>: All resources created without errors</li> <li><strong>Tool</strong>: Terraform apply output</li> <li><strong>Evidence</strong>: <code>Apply complete! Resources: X added, 0 changed, 0 destroyed.</code></li> </ul> <h3 id=5-smoke-tests-100-pass>5. Smoke Tests: 100% Pass<a class=headerlink href=#5-smoke-tests-100-pass title="Permanent link">&para;</a></h3> <ul> <li><strong>Tests</strong>: Cosmos DB connectivity, AI Search reachable, OpenAI API working, Blob Storage accessible</li> <li><strong>Tool</strong>: Custom Bash scripts (<code>scripts/smoke-test.sh</code>)</li> <li><strong>Evidence</strong>: Test output showing all checks passed</li> </ul> <h3 id=6-state-consistency-no-drift>6. State Consistency: No Drift<a class=headerlink href=#6-state-consistency-no-drift title="Permanent link">&para;</a></h3> <ul> <li><strong>Metric</strong>: <code>terraform plan</code> shows no changes (after apply)</li> <li><strong>Tool</strong>: <code>terraform plan -detailed-exitcode</code></li> <li><strong>Evidence</strong>: Exit code 0 (no changes)</li> </ul> <h3 id=7-backup-restore-100-success>7. Backup &amp; Restore: 100% Success<a class=headerlink href=#7-backup-restore-100-success title="Permanent link">&para;</a></h3> <ul> <li><strong>Test</strong>: Destroy prod, restore from backup, verify data integrity</li> <li><strong>Tool</strong>: Azure CLI + Cosmos DB restore API</li> <li><strong>Evidence</strong>: Data restored successfully</li> </ul> <h3 id=8-documentation-100-complete>8. Documentation: 100% Complete<a class=headerlink href=#8-documentation-100-complete title="Permanent link">&para;</a></h3> <ul> <li><strong>Sections</strong>: PROVISIONING.md, ROLLBACK.md, COST-OPTIMIZATION.md</li> <li><strong>Evidence</strong>: All docs exist with step-by-step guides</li> </ul> <h3 id=9-secrets-management-zero-secrets-in-code>9. Secrets Management: Zero Secrets in Code<a class=headerlink href=#9-secrets-management-zero-secrets-in-code title="Permanent link">&para;</a></h3> <ul> <li><strong>Tool</strong>: git-secrets, trufflehog</li> <li><strong>Evidence</strong>: No Azure keys, connection strings, or passwords in Git history</li> </ul> <h3 id=10-multi-environment-isolation-100>10. Multi-Environment Isolation: 100%<a class=headerlink href=#10-multi-environment-isolation-100 title="Permanent link">&para;</a></h3> <ul> <li><strong>Test</strong>: Create user in dev, verify NOT visible in test/prod</li> <li><strong>Tool</strong>: Custom Cosmos DB query script</li> <li><strong>Evidence</strong>: Zero cross-environment data leakage</li> </ul> <h3 id=11-rollback-success-5-minutes>11. Rollback Success: &lt; 5 minutes<a class=headerlink href=#11-rollback-success-5-minutes title="Permanent link">&para;</a></h3> <ul> <li><strong>Metric</strong>: Time to rollback failed deployment</li> <li><strong>Tool</strong>: <code>terraform destroy</code> + <code>terraform apply</code> with previous state</li> <li><strong>Evidence</strong>: Rollback completed in &lt; 5 minutes</li> </ul> <h3 id=12-monitoring-alerts-100-functional>12. Monitoring Alerts: 100% Functional<a class=headerlink href=#12-monitoring-alerts-100-functional title="Permanent link">&para;</a></h3> <ul> <li><strong>Test</strong>: Trigger cost alert (simulate $40 spend), verify email received</li> <li><strong>Tool</strong>: Azure Monitor alert simulation</li> <li><strong>Evidence</strong>: Email/SMS received within 5 minutes</li> </ul> <hr> <h2 id=7-implementation-phases-4-phases-6-weeks>7. Implementation Phases (4 Phases, 6 Weeks)<a class=headerlink href=#7-implementation-phases-4-phases-6-weeks title="Permanent link">&para;</a></h2> <h3 id=phase-1-core-infrastructure-weeks-1-2>Phase 1: Core Infrastructure (Weeks 1-2)<a class=headerlink href=#phase-1-core-infrastructure-weeks-1-2 title="Permanent link">&para;</a></h3> <p><strong>Goal</strong>: Provision Cosmos DB, Blob Storage, Key Vault</p> <p><strong>Tasks</strong>: 1. Setup Terraform project structure 2. Configure Azure RM provider + remote state backend 3. Create Cosmos DB module (account + containers) 4. Create Blob Storage module (account + containers) 5. Create Key Vault module (vault + secrets) 6. Write Terraform variables for dev/test/prod 7. CI/CD: GitHub Actions for <code>terraform plan</code> 8. Smoke tests: Connectivity checks</p> <p><strong>Deliverables</strong>: - Cosmos DB provisioned with dev/test/prod containers - Blob Storage provisioned with lifecycle policies - Key Vault storing connection strings - CI/CD pipeline running <code>terraform plan</code> on PR</p> <p><strong>Evidence</strong>: - Azure Portal screenshots showing resources - Terraform apply output showing success - Smoke tests passing</p> <hr> <h3 id=phase-2-ai-services-weeks-3-4>Phase 2: AI Services (Weeks 3-4)<a class=headerlink href=#phase-2-ai-services-weeks-3-4 title="Permanent link">&para;</a></h3> <p><strong>Goal</strong>: Provision Azure AI Search, Azure OpenAI, Redis</p> <p><strong>Tasks</strong>: 1. Create Azure AI Search module (service + indexes) 2. Create Azure OpenAI module (account + deployments: GPT-4o, embeddings) 3. Create Redis module (cache instances) 4. Configure private endpoints (prod only) 5. Update Key Vault with AI service keys 6. CI/CD: Add <code>terraform apply</code> workflow (with approval gates) 7. Smoke tests: AI Search query, OpenAI API call, Redis set/get</p> <p><strong>Deliverables</strong>: - Azure AI Search indexed (empty, ready for documents) - Azure OpenAI deployments active (GPT-4o + embeddings) - Redis cache operational - Private endpoints configured for prod</p> <p><strong>Evidence</strong>: - AI Search query returns 200 OK - OpenAI API call returns valid response - Redis set/get working - Terraform apply successful</p> <hr> <h3 id=phase-3-networking-security-week-5>Phase 3: Networking &amp; Security (Week 5)<a class=headerlink href=#phase-3-networking-security-week-5 title="Permanent link">&para;</a></h3> <p><strong>Goal</strong>: Configure VNet, NSGs, private endpoints, RBAC</p> <p><strong>Tasks</strong>: 1. Create Networking module (VNet, subnets, NSGs) 2. Configure private endpoints for all services (prod) 3. Setup RBAC roles (Managed Identity for services) 4. Configure Azure Firewall rules (if needed) 5. Security scan with tfsec (fix all high/critical issues) 6. Update Key Vault access policies (deny public access in prod) 7. Smoke tests: Verify private endpoint connectivity</p> <p><strong>Deliverables</strong>: - VNet provisioned with subnets - Private endpoints active for prod - RBAC roles assigned - tfsec scan passing</p> <p><strong>Evidence</strong>: - VNet diagram showing subnets - Private endpoint connectivity test passed - tfsec report with zero high/critical issues</p> <hr> <h3 id=phase-4-monitoring-docs-week-6>Phase 4: Monitoring &amp; Docs (Week 6)<a class=headerlink href=#phase-4-monitoring-docs-week-6 title="Permanent link">&para;</a></h3> <p><strong>Goal</strong>: Setup monitoring, alerts, documentation</p> <p><strong>Tasks</strong>: 1. Create Monitoring module (Log Analytics, Application Insights) 2. Configure cost alerts ($40/month threshold) 3. Setup Grafana dashboards (optional) 4. Write PROVISIONING.md (step-by-step deployment guide) 5. Write ROLLBACK.md (disaster recovery procedures) 6. Write COST-OPTIMIZATION.md (strategies to reduce costs) 7. Final smoke tests (end-to-end) 8. Load testing (optional)</p> <p><strong>Deliverables</strong>: - Monitoring operational (logs, metrics, alerts) - Cost alert triggered successfully - All documentation complete - All 12 quality gates passed</p> <p><strong>Evidence</strong>: - Application Insights showing traces - Cost alert email received - Documentation reviewed and approved - Quality gates report</p> <hr> <h2 id=8-references>8. References<a class=headerlink href=#8-references title="Permanent link">&para;</a></h2> <h3 id=terraform-azure-patterns>Terraform Azure Patterns<a class=headerlink href=#terraform-azure-patterns title="Permanent link">&para;</a></h3> <ul> <li><strong>Azure Provider Docs</strong>: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs</li> <li><strong>Terraform Best Practices</strong>: https://www.terraform.io/docs/language/modules/develop/best-practices.html</li> </ul> <h3 id=reference-implementations>Reference Implementations<a class=headerlink href=#reference-implementations title="Permanent link">&para;</a></h3> <ul> <li><strong>PubSec Info Assistant</strong>: <code>PubSec-Info-Assistant/infra/main.tf</code> (Terraform + ARM templates)</li> <li><strong>EVA Orchestrator Templates</strong>: <code>eva-orchestrator/templates/eva-infra/</code> (module structure)</li> </ul> <h3 id=azure-services>Azure Services<a class=headerlink href=#azure-services title="Permanent link">&para;</a></h3> <ul> <li><strong>Cosmos DB</strong>: https://learn.microsoft.com/azure/cosmos-db/</li> <li><strong>Azure AI Search</strong>: https://learn.microsoft.com/azure/search/</li> <li><strong>Azure OpenAI</strong>: https://learn.microsoft.com/azure/ai-services/openai/</li> </ul> <h3 id=cost-optimization>Cost Optimization<a class=headerlink href=#cost-optimization title="Permanent link">&para;</a></h3> <ul> <li><strong>Azure Pricing Calculator</strong>: https://azure.microsoft.com/en-us/pricing/calculator/</li> <li><strong>Shared Infrastructure</strong>: Marco's approved model ($36/month)</li> </ul> <hr> <h2 id=9-next-steps>9. Next Steps<a class=headerlink href=#9-next-steps title="Permanent link">&para;</a></h2> <ol> <li> <p><strong>Marco Opens eva-infra Workspace</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nb>cd </span><span class=s2>&quot;C:\Users\marco\Documents\_AI Dev\EVA Suite&quot;</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>code</span> <span class=n>eva-infra</span>
</span></code></pre></div></p> </li> <li> <p><strong>Run Startup Script</strong>: <div class="language-powershell highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=p>.\</span><span class=n>_MARCO-use-this-to-tell_copilot-to-read-repo-specific-instructions</span><span class=p>.</span><span class=n>ps1</span>
</span></code></pre></div></p> </li> <li> <p><strong>Give Task</strong>: <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>Implement Phase 1: Core Infrastructure (Cosmos DB, Blob Storage, Key Vault).
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>Follow specification TO THE LETTER.
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>Use PubSec Info Assistant patterns (Terraform + ARM templates).
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>Create Terraform modules for each resource type.
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>Setup remote state backend.
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>Write CI/CD workflows for terraform plan.
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>Show terraform apply output + smoke test results when done.
</span></code></pre></div></p> </li> </ol> <hr> <p><strong>END OF SPECIFICATION</strong></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 MarcoPolo483 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/MarcoPolo483/eva-orchestrator target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.d7c377c4.min.js></script> <script src=../../javascripts/extra.js></script> </body> </html>